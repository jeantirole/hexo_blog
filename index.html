<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title> </title><meta property="og:type" content="blog"><meta property="og:title" content=""><meta property="og:url" content="http://yoursite.com/"><meta property="og:site_name" content=""><meta property="og:locale" content="en_US"><meta property="og:image" content="http://yoursite.com/img/og_image.png"><meta property="article:author" content="Eric Park"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com"},"headline":"","image":["http://yoursite.com/img/og_image.png"],"author":{"@type":"Person","name":"Eric Park"},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/tomorrow-night.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12-tablet is-12-desktop is-12-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-10-20T04:05:12.000Z" title="2020-10-20T04:05:12.000Z">2020-10-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-10-20T07:47:29.966Z" title="2020-10-20T07:47:29.966Z">2020-10-20</time></span><span class="level-item"><a class="link-muted" href="/categories/Projects/">Projects</a><span> / </span><a class="link-muted" href="/categories/Projects/Time-Series/">Time Series</a></span><span class="level-item">41 minutes read (About 6155 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/10/20/Project_Card_Sales_1019_1/">Project_DACON_상점 신용카드 매출 예측 경진대회</a></h1><div class="content"><p><br><br/></p>
<h3 id="Portfolio-for-Time-Series"><a href="#Portfolio-for-Time-Series" class="headerlink" title="- Portfolio for Time-Series"></a>- Portfolio for Time-Series</h3><blockquote>
<ul>
<li><strong><em>개인적인 시계열 분석 포트폴리오 작성을 위하여, 아래의 DACON 대회 자료를 활용하였습니다. (현재종료 2019년 대회)</em></strong></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>대회유형: 시계열 예측  </li>
<li>대회목적: 핀테크 기업인 ‘FUNDA(펀다)’는 상환 기간의 매출을 예측하여 신용 점수가 낮거나 담보를 가지지 못하는 우수 상점들에 금융 기회를 제공하려 합니다. 이번 대회에서는 2년 전 부터 2019년 2월 28일까지의 카드 거래 데이터를 이용해 2019-03-01부터 2019-05-31까지의 각 상점별 3개월 총 매출을 예측하는 것입니다.</li>
<li>데이터제공기간: 2016-06-01 ~ 2019-2-28 (1002 days)   </li>
<li>데이터예측기간: 2019-03-01 ~ 2019-05-31 (92 days)  </li>
<li>데이터사이즈:  6,556,613 entries , 9 columns, memory 450MB<br>Link: <a target="_blank" rel="noopener" href="https://dacon.io/competitions/official/140472/overview/">https://dacon.io/competitions/official/140472/overview/</a>  </li>
<li>Data Description<br>store_id : 상점의 고유 아이디<br>card_id : 사용한 카드의 고유 아이디<br>card_company : 비식별화된 카드 회사<br>trasacted_date : 거래 날짜<br>transacted_time : 거래 시간( 시:분 )<br>installment_term : 할부 개월 수( 포인트 사용 시 (60개월 + 실제할부개월)을 할부개월수에 기재한다. )<br>region : 상점의 지역<br>type_of_business : 상점의 업종<br>amount : 거래액(단위는 원이 아닙니다)  </li>
</ul>
</blockquote>
<h3 id="Project-Summary"><a href="#Project-Summary" class="headerlink" title="- Project Summary"></a>- Project Summary</h3><blockquote>
<ol>
<li>프로젝트 진행 일정<br>2020-10-07 ~ 2020-10-16 (9 days)</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>개발환경<br>OS: Window<br>IDE: Visual Studio Code, Jupyter Notebook<br>VCS: Git, SourceTree </li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>프로젝트 최종 결과 (9등, 상위권)<table>
<thead>
<tr>
<th>Model</th>
<th>MAE(Mean Absolute Error,<br>평균절대오차)</th>
<th>Public Board Rank</th>
</tr>
</thead>
<tbody><tr>
<td>Exponential_Moving Average(5)</td>
<td>765,887</td>
<td>9등(최종)</td>
</tr>
<tr>
<td>Exponential_Moving Average(3)</td>
<td>784,219</td>
<td>18등</td>
</tr>
<tr>
<td>Simple_Moving_Average(3)</td>
<td>810,333</td>
<td>25등</td>
</tr>
<tr>
<td>ARIMA_n_LGBM</td>
<td>1,768,874</td>
<td>93등</td>
</tr>
<tr>
<td>ARIMA</td>
<td>1,062,635</td>
<td>50등</td>
</tr>
<tr>
<td>LGBM</td>
<td>2,481,832</td>
<td>102등</td>
</tr>
</tbody></table>
</li>
</ol>
<p>*우측 CATALOGUE 에서 Conclusion 링크를 클릭하시면 프로젝트 결과에 관한 설명 및 요약 리포트를 확인하실 수 있습니다. </p>
</blockquote>
<blockquote>
<ol start="4">
<li><p>프로젝트 목차  </p>
<p>-1. Portfolio for Time-Series<br>-2. Project Summary<br>-3. Data_Load<br>-4. EDA_Part_1<br>-5. EDA_Part_2<br>-6. Data Preprocessing<br>-7. LGBM Modeling<br>-8. Modeling_MA&amp;EPMA&amp;ARIMA<br>-9. Moving Average<br>-10. Exponential Moving Average<br>-11. ARIMA<br>-12. Conclusion </p>
</li>
</ol>
</blockquote>
<h3 id="Data-Load"><a href="#Data-Load" class="headerlink" title="Data_Load"></a>Data_Load</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> tqdm.autonotebook <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> lightgbm <span class="keyword">import</span> LGBMRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">import</span> plotly_express <span class="keyword">as</span> px</span><br><span class="line"><span class="keyword">import</span> matplotlib.pylab <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.family&#x27;</span>] = <span class="string">&#x27;Malgun Gothic&#x27;</span></span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.seasonal <span class="keyword">import</span> seasonal_decompose</span><br></pre></td></tr></table></figure>

<pre><code>C:\ProgramData\Anaconda3\lib\site-packages\ipykernel_launcher.py:3: TqdmExperimentalWarning: Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)
  This is separate from the ipykernel package so we can avoid doing imports until</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># raw data load </span></span><br><span class="line">sales = pd.read_csv(<span class="string">&#x27;C:\Archaon\projects\Card_Sales\Dataset\copy_train.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="EDA-Part-1"><a href="#EDA-Part-1" class="headerlink" title="EDA_Part_1"></a><strong>EDA_Part_1</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. raw data</span></span><br><span class="line">sales.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6556613 entries, 0 to 6556612
Data columns (total 9 columns):
 #   Column            Dtype  
---  ------            -----  
 0   store_id          int64  
 1   card_id           int64  
 2   card_company      object 
 3   transacted_date   object 
 4   transacted_time   object 
 5   installment_term  int64  
 6   region            object 
 7   type_of_business  object 
 8   amount            float64
dtypes: float64(1), int64(3), object(5)
memory usage: 450.2+ MB</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.1 missing values </span></span><br><span class="line">sales.isnull().sum()</span><br></pre></td></tr></table></figure>




<pre><code>store_id                  0
card_id                   0
card_company              0
transacted_date           0
transacted_time           0
installment_term          0
region              2042766
type_of_business    3952609
amount                    0
dtype: int64</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Before Downcasting </span></span><br><span class="line">sales_bd = np.round(sales.memory_usage().sum()/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">1</span>)</span><br><span class="line">sales_bd <span class="comment">#450</span></span><br></pre></td></tr></table></figure>




<pre><code>450.2</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Memory Downcast</span></span><br><span class="line"><span class="comment"># 데이터 메모리 축소를 위한 downcast 함수 생성 및 적용  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downcast</span>(<span class="params">df</span>):</span></span><br><span class="line">    cols = df.dtypes.index.tolist()</span><br><span class="line">    types = df.dtypes.values.tolist()</span><br><span class="line">    <span class="keyword">for</span> i,t <span class="keyword">in</span> enumerate(types):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;int&#x27;</span> <span class="keyword">in</span> str(t):</span><br><span class="line">            <span class="keyword">if</span> df[cols[i]].min() &gt; np.iinfo(np.int8).min <span class="keyword">and</span> df[cols[i]].max() &lt; np.iinfo(np.int8).max:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.int8)</span><br><span class="line">            <span class="keyword">elif</span> df[cols[i]].min() &gt; np.iinfo(np.int16).min <span class="keyword">and</span> df[cols[i]].max() &lt; np.iinfo(np.int16).max:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.int16)</span><br><span class="line">            <span class="keyword">elif</span> df[cols[i]].min() &gt; np.iinfo(np.int32).min <span class="keyword">and</span> df[cols[i]].max() &lt; np.iinfo(np.int32).max:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.int32)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.int64)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;float&#x27;</span> <span class="keyword">in</span> str(t):</span><br><span class="line">            <span class="keyword">if</span> df[cols[i]].min() &gt; np.finfo(np.float16).min <span class="keyword">and</span> df[cols[i]].max() &lt; np.finfo(np.float16).max:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.float16)</span><br><span class="line">            <span class="keyword">elif</span> df[cols[i]].min() &gt; np.finfo(np.float32).min <span class="keyword">and</span> df[cols[i]].max() &lt; np.finfo(np.float32).max:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.float32)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(np.float64)</span><br><span class="line">        <span class="keyword">elif</span> t == np.object:</span><br><span class="line">            <span class="keyword">if</span> cols[i] == <span class="string">&#x27;date&#x27;</span>:</span><br><span class="line">                df[cols[i]] = pd.to_datetime(df[cols[i]], format=<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                df[cols[i]] = df[cols[i]].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> df  </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Downcast Data</span></span><br><span class="line">sales = downcast(sales)</span><br><span class="line"></span><br><span class="line"><span class="comment"># After Downcasting </span></span><br><span class="line">sales_ad = np.round(sales.memory_usage().sum()/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">1</span>) <span class="comment">#125.2</span></span><br><span class="line">sales_ad</span><br></pre></td></tr></table></figure>




<pre><code>125.2</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plotly_express <span class="keyword">as</span> px</span><br><span class="line"></span><br><span class="line">dic = &#123;<span class="string">&#x27;DataFrame&#x27;</span>:[<span class="string">&#x27;sales&#x27;</span>],</span><br><span class="line">       <span class="string">&#x27;Before downcasting&#x27;</span>:[sales_bd],</span><br><span class="line">       <span class="string">&#x27;After downcasting&#x27;</span>:[sales_ad]&#125;</span><br><span class="line"></span><br><span class="line">memory = pd.DataFrame(dic)</span><br><span class="line">memory = pd.melt(memory, id_vars=<span class="string">&#x27;DataFrame&#x27;</span>, var_name=<span class="string">&#x27;Status&#x27;</span>, value_name=<span class="string">&#x27;Memory (MB)&#x27;</span>)</span><br><span class="line">memory.sort_values(<span class="string">&#x27;Memory (MB)&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">fig = px.bar(memory, x=<span class="string">&#x27;DataFrame&#x27;</span>, y=<span class="string">&#x27;Memory (MB)&#x27;</span>, color=<span class="string">&#x27;Status&#x27;</span>, barmode=<span class="string">&#x27;group&#x27;</span>, text=<span class="string">&#x27;Memory (MB)&#x27;</span>)</span><br><span class="line">fig.update_traces(texttemplate=<span class="string">&#x27;%&#123;text&#125; MB&#x27;</span>, textposition=<span class="string">&#x27;outside&#x27;</span>)</span><br><span class="line">fig.update_layout(template=<span class="string">&#x27;seaborn&#x27;</span>, title=<span class="string">&#x27;Effect of Downcasting&#x27;</span>)</span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="/img/output_12.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.2 columns</span></span><br><span class="line"><span class="comment"># 1.2.1 [&#x27;store_id&#x27;]</span></span><br><span class="line">len(sales[<span class="string">&#x27;store_id&#x27;</span>].unique()) <span class="comment">#1967</span></span><br><span class="line"><span class="comment">## 1967개의 store_id 가 존재한다. </span></span><br><span class="line">store_counts = sales[<span class="string">&#x27;store_id&#x27;</span>].value_counts().reset_index()</span><br><span class="line">store_counts = pd.DataFrame(store_counts )</span><br><span class="line">store_counts.columns = [<span class="string">&#x27;store_id&#x27;</span>,<span class="string">&#x27;counts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.boxplot(x=<span class="string">&quot;counts&quot;</span>, data =store_counts)</span><br><span class="line">ax = sns.swarmplot(x=<span class="string">&quot;counts&quot;</span>, data =store_counts, palette=<span class="string">&quot;ocean&quot;</span>)</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;결제횟수 by Store ID&quot;</span>, ylabel=<span class="string">&quot;Box Plot&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure1&gt;, 상점 Store ID 별 결제횟수 분포&quot;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/output_13_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.2.2 [&#x27;card_company]</span></span><br><span class="line">len(sales) </span><br><span class="line"><span class="comment"># = 6,556,613</span></span><br><span class="line">len(sales[<span class="string">&#x27;card_id&#x27;</span>].unique())  </span><br><span class="line"><span class="comment"># = 3,950,001</span></span><br><span class="line"><span class="comment">## sales 데이터의 entry 는 card_id를 기준으로 작성되었다.</span></span><br><span class="line"><span class="comment">## 따라서, 1 entry = 1 card transaction 으로 이해할 수 있다. </span></span><br><span class="line"><span class="comment">## 하지만 데이터상의 고유 card_id 의 수는 3,950,001 개로, 전체 거래량인 6,556,613 에 비해서 40% 정도 작다. </span></span><br><span class="line"><span class="comment">## 그러므로 전체 거래량의 40%는 동일한 카드의 중복거래란 것을 확인할 수 있다. </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sales.card_company </span><br><span class="line"><span class="comment">## Categories (8, object): [a, b, c, d, e, f, g, h]</span></span><br><span class="line"></span><br><span class="line">card_company = sales[<span class="string">&#x27;card_company&#x27;</span>].value_counts()</span><br><span class="line">card_company = pd.DataFrame(card_company)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(x=card_company.index , y = <span class="string">&quot;card_company&quot;</span>, palette=<span class="string">&quot;CMRmap_r&quot;</span>, data =card_company )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;Card Company&quot;</span>, ylabel=<span class="string">&quot;결제횟수 합계&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure2&gt;, 카드회사별 결제횟수 합계&quot;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_14_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1.2.4 [&#x27;transacted_date&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 카드 거래일자는 2016년 6월1일부터, 2019년 2월 28일까지이며, day 기준으로 1002 일이다. </span></span><br><span class="line"><span class="comment">## 본 대회의 경우, 1002일 간의 카드거래 데이터로, 향후 3달후의 상점별 매출액을 예상하는 대회이다. </span></span><br><span class="line"><span class="comment">## 따라서 거래일자는 아래와 같은 구간으로 나눠진다. </span></span><br><span class="line"><span class="comment">## train period : 2016.6.1 ~ 2019.2.28 (1002 days) </span></span><br><span class="line"><span class="comment">## test period  : 2019.3.1 ~ 2019.5.31 (91 days)</span></span><br><span class="line"></span><br><span class="line">sales[<span class="string">&#x27;transacted_date&#x27;</span>]</span><br><span class="line"><span class="comment"># 0          2016-06-01</span></span><br><span class="line"><span class="comment"># 1          2016-06-01</span></span><br><span class="line"><span class="comment"># 2          2016-06-01</span></span><br><span class="line"><span class="comment"># 3          2016-06-01</span></span><br><span class="line"><span class="comment"># 4          2016-06-02</span></span><br><span class="line"><span class="comment">#               ...</span></span><br><span class="line"><span class="comment"># 6556608    2019-02-28</span></span><br><span class="line"><span class="comment"># 6556609    2019-02-28</span></span><br><span class="line"><span class="comment"># 6556610    2019-02-28</span></span><br><span class="line"><span class="comment"># 6556611    2019-02-28</span></span><br><span class="line"><span class="comment"># 6556612    2019-02-28</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2.5 [&#x27;transacted_time&#x27;] &amp; [&#x27;installment_term]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## transacted_time 과 installment_term 각각 카드거래 시각과 할부 개월수를 의미한다. </span></span><br><span class="line"><span class="comment">## 이러한 분포는 상점의 사업종류에 따라서 편차가 클 것으로 예상된다. </span></span><br><span class="line"><span class="comment">## 상점 하나(store_id == 1000)를 샘플로 골라서, 분포를 살펴보도록 하겠다. </span></span><br><span class="line"><span class="comment">## 선택된 상점의 경우에, type of business 가 &#x27;의복 소매업&#x27;이다. 따라서 사람들이 많이 쇼핑하는 </span></span><br><span class="line"><span class="comment">## 주말 오후 시간대 14 ~ 18 시 사이에, 카드결제 시간이 몰려 있는 것으로 확인된다. </span></span><br><span class="line"></span><br><span class="line">store_1000 = sales[ sales[<span class="string">&#x27;store_id&#x27;</span>] == <span class="number">1000</span> ]</span><br><span class="line"><span class="comment">###</span></span><br><span class="line">len(store_1000)</span><br><span class="line">blank = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(store_1000)):   </span><br><span class="line">    str1 = int(store_1000[<span class="string">&#x27;transacted_time&#x27;</span>].iloc[i][<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">    blank.append(str1)</span><br><span class="line">blank</span><br><span class="line">blank = pd.DataFrame(blank, columns=[<span class="string">&#x27;Count&#x27;</span>])</span><br><span class="line">time_count = pd.DataFrame(blank[<span class="string">&#x27;Count&#x27;</span>].value_counts())</span><br><span class="line"><span class="comment">###</span></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(x=time_count.index , y = <span class="string">&quot;Count&quot;</span>, data =time_count )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;카드결제시각&quot;</span>, ylabel=<span class="string">&quot;카드결제횟수&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure3&gt;, Store_id = 1000, 카드결제시각 당 카드결제횟수&quot;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_15_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.2.6 [&#x27;region&#x27;] &amp; [&#x27;type of business&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## region 과 type of business 의 경우에 결측치가 많다. </span></span><br><span class="line"><span class="comment">## region 의 경우에는 총 데이터의 31%가 결측치이며, business의 경우에 60%가 결측치이다. </span></span><br><span class="line"></span><br><span class="line">null_result = sales.isnull().sum()</span><br><span class="line">null_result = pd.DataFrame(null_result,columns=[<span class="string">&#x27;count&#x27;</span>])</span><br><span class="line">null_result = null_result.reset_index()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(x=<span class="string">&quot;index&quot;</span> , y = <span class="string">&quot;count&quot;</span>, data =null_result , palette= <span class="string">&quot;ocean&quot;</span> )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;Data Columns&quot;</span>, ylabel=<span class="string">&quot;Null Counts&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure4&gt;, 결측치확인 &quot;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line"><span class="comment"># 1.2.7 [&#x27;amount&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 주어진 데이터의 거래액은 카드결제 당 금액으로 입력되어있다. 하지만 예측이 필요한 3개월의 데이터는 </span></span><br><span class="line"><span class="comment">## 상점별 매출이므로, amount 금액 또한 store_id 를 기준으로 groupby 한 금액을 본다.  </span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_16_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.2.7 [&#x27;amount&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 주어진 데이터의 거래액은 카드결제 당 금액으로 입력되어있다. 하지만 예측이 필요한 3개월의 데이터는 </span></span><br><span class="line"><span class="comment">## 상점별 매출이므로, amount 금액 또한 store_id 를 기준으로 groupby 한 금액을 본다.  </span></span><br><span class="line"><span class="comment">## 상점별 매출의 경우 피라미드 형태의 매출을 보여주고 있으며, 특정 상점이 이상치에 가까운 매출액을 보여주고 있다. </span></span><br><span class="line"></span><br><span class="line">s1 = sales.groupby(<span class="string">&#x27;store_id&#x27;</span>).sum().reset_index()</span><br><span class="line">s1[<span class="string">&#x27;amount&#x27;</span>] = s1[<span class="string">&#x27;amount&#x27;</span>].astype(int)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.boxplot(x=<span class="string">&quot;amount&quot;</span>, data =s1)</span><br><span class="line">ax = sns.swarmplot(x=<span class="string">&quot;amount&quot;</span>, data=s1, palette=<span class="string">&quot;ocean&quot;</span>)</span><br><span class="line"></span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;Card Transaction Amount&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure5&gt;, 상점별 카드매출액 분포 &quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<p><img src="/img/output_17_0.png"></p>
<h3 id="EDA-Part-2"><a href="#EDA-Part-2" class="headerlink" title="EDA_Part_2"></a><strong>EDA_Part_2</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sido 데이터 뽑아내기 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#region &amp; type of business 가 있는 데이터로 그룹 나누기 </span></span><br><span class="line">sales_region = sales[[<span class="string">&#x27;store_id&#x27;</span>,<span class="string">&#x27;region&#x27;</span>]]</span><br><span class="line">sales_region_null = sales_region.isnull() </span><br><span class="line">region_index_list = sales_region_null[ sales_region_null[<span class="string">&#x27;region&#x27;</span>]== <span class="number">0</span> ].index <span class="comment">#length 2042766 #4513847 False </span></span><br><span class="line"><span class="comment"># Sales 데이터에서 region 값이 있는 데이터들을 찾기 </span></span><br><span class="line">sales1 = sales.iloc[ region_index_list, :]</span><br><span class="line">sales1.type_of_business.isnull().sum()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#결측치행 drop </span></span><br><span class="line">sales_c = sales.copy()</span><br><span class="line">group1 = sales_c.dropna(subset = [<span class="string">&#x27;region&#x27;</span>, <span class="string">&#x27;type_of_business&#x27;</span>] )</span><br><span class="line">group1 <span class="comment">#[2318410 rows x 9 columns] # group1  =  35% 전체데이터에서 </span></span><br><span class="line"></span><br><span class="line">sido_list = group1[<span class="string">&#x27;region&#x27;</span>].str[<span class="number">0</span>:<span class="number">2</span>]  </span><br><span class="line">sido_list = pd.DataFrame(sido_list)</span><br><span class="line">sido_list.columns = [<span class="string">&#x27;region_sido&#x27;</span>]</span><br><span class="line">group1_sido = pd.concat([group1, sido_list] ,axis = <span class="number">1</span> )</span><br><span class="line"><span class="comment">#### group 구분 4단계 </span></span><br><span class="line"><span class="comment">## group1 둘다 있음   group1  =  35% 전체데이터에서 </span></span><br><span class="line"><span class="comment">## group2 비지니스만 </span></span><br><span class="line"><span class="comment">## group3 지역만</span></span><br><span class="line"><span class="comment">## group4 둘다없음 </span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Group1 시도별, amount 금액 합계 </span></span><br><span class="line">ra = group1_sido.groupby(<span class="string">&#x27;region_sido&#x27;</span>)[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">ras = ra.reset_index()</span><br><span class="line">ras = ras.sort_values(by=[<span class="string">&#x27;amount&#x27;</span>], axis=<span class="number">0</span>,ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(x=<span class="string">&#x27;region_sido&#x27;</span> , y = <span class="string">&quot;amount&quot;</span>, data =ras )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;시도&quot;</span>, ylabel=<span class="string">&quot;카드매출금액합계&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure6&gt;, 시도별 카드매출금액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_20_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 시도별, 결제 횟수 합계 </span></span><br><span class="line">rs = group1_sido[<span class="string">&#x27;region_sido&#x27;</span>].value_counts()</span><br><span class="line">res = rs.reset_index()</span><br><span class="line">res</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(x=<span class="string">&#x27;index&#x27;</span> , y = <span class="string">&quot;region_sido&quot;</span>, data =res )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;카드결제횟수 합계&quot;</span>, ylabel=<span class="string">&quot;counts&quot;</span>)</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure7&gt;, 시도별 카드결제횟수 합계 &quot;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_21_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 업종별 결제금액 합계 </span></span><br><span class="line">tba = group1_sido.groupby(<span class="string">&#x27;type_of_business&#x27;</span>)[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">tba = tba.reset_index()</span><br><span class="line">tbas = tba.sort_values(by=[<span class="string">&#x27;amount&#x27;</span>], axis=<span class="number">0</span>,ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line">ax = sns.barplot(y=<span class="string">&#x27;type_of_business&#x27;</span> , x=<span class="string">&quot;amount&quot;</span>, data =tbas, order=tbas.sort_values(<span class="string">&#x27;amount&#x27;</span>,ascending = <span class="literal">False</span>).type_of_business  )</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;결제금액합&quot;</span>, ylabel=<span class="string">&quot;type_of_business&quot;</span>, )</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure8&gt;, 업종별 카드결제금액 합계 &quot;</span>)</span><br><span class="line">ax.set_xticklabels(ax.get_xticklabels(), rotation=<span class="number">90</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<p><img src="/img/output_22_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 결제금액 top 10, Business type </span></span><br><span class="line">new_tb= tbas[<span class="number">0</span>:<span class="number">9</span>]</span><br><span class="line">new_tb</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>type_of_business</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>139</th>
      <td>한식 음식점업</td>
      <td>4.355464e+09</td>
    </tr>
    <tr>
      <th>99</th>
      <td>의복 소매업</td>
      <td>1.954874e+09</td>
    </tr>
    <tr>
      <th>101</th>
      <td>의약품 도매업</td>
      <td>1.568540e+09</td>
    </tr>
    <tr>
      <th>105</th>
      <td>일반 교과 학원</td>
      <td>1.168244e+09</td>
    </tr>
    <tr>
      <th>54</th>
      <td>두발 미용업</td>
      <td>8.859701e+08</td>
    </tr>
    <tr>
      <th>108</th>
      <td>일식 음식점업</td>
      <td>8.170945e+08</td>
    </tr>
    <tr>
      <th>46</th>
      <td>기타 주점업</td>
      <td>6.550956e+08</td>
    </tr>
    <tr>
      <th>37</th>
      <td>기타 스포츠 교육기관</td>
      <td>6.052595e+08</td>
    </tr>
    <tr>
      <th>82</th>
      <td>안경 및 렌즈 소매업</td>
      <td>5.064083e+08</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 매출 top 10 업종이 전체 매출에서 차지하는 비중 ## </span></span><br><span class="line">group1[<span class="string">&#x27;amount&#x27;</span>].sum() <span class="comment">#25,657,748,130</span></span><br><span class="line">tbas[<span class="string">&#x27;amount&#x27;</span>][<span class="number">0</span>:<span class="number">10</span>].sum() <span class="comment">#1,071,393,938</span></span><br><span class="line"><span class="comment">#13020321268 / 25657748130   # 상위 10개가 전체 매출의 50 %</span></span><br><span class="line">tbas[<span class="string">&#x27;amount&#x27;</span>][<span class="number">0</span>:<span class="number">5</span>].sum()  <span class="comment">#9,933,091,985</span></span><br><span class="line"><span class="comment">#9933091985 / 25657748130    # 상위 5개가 전체 매출의 38 %</span></span><br><span class="line">tbas[<span class="string">&#x27;amount&#x27;</span>][<span class="number">0</span>:<span class="number">1</span>].sum()  <span class="comment">#4,355,463,710</span></span><br><span class="line"><span class="comment">#4355463710 / 25657748130    # top 1(한식음식점업)이 전체 매출의 16%</span></span><br></pre></td></tr></table></figure>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## top3 지역별 매출액 합계 </span></span><br><span class="line">group1_sido[<span class="string">&#x27;transacted_date&#x27;</span>] = pd.to_datetime(group1_sido[<span class="string">&#x27;transacted_date&#x27;</span>] )</span><br><span class="line"></span><br><span class="line">group1_gy = group1_sido[group1_sido[<span class="string">&#x27;region_sido&#x27;</span>] == <span class="string">&quot;경기&quot;</span>]</span><br><span class="line">group1_gy_new = group1_gy.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_gy_new = group1_gy_new.reset_index()</span><br><span class="line"></span><br><span class="line">group1_se = group1_sido[group1_sido[<span class="string">&#x27;region_sido&#x27;</span>] == <span class="string">&quot;서울&quot;</span>]</span><br><span class="line">group1_se_new = group1_se.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_se_new = group1_se_new.reset_index()</span><br><span class="line"></span><br><span class="line">group1_pu = group1_sido[group1_sido[<span class="string">&#x27;region_sido&#x27;</span>] == <span class="string">&quot;부산&quot;</span>]</span><br><span class="line">group1_pu_new = group1_pu.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_pu_new = group1_pu_new.reset_index()</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(nrows=<span class="number">3</span>, figsize = (<span class="number">18</span>, <span class="number">12</span>))</span><br><span class="line"><span class="comment">#f,axes = plt.subplots(3,1, figsize = (18,12), sharex=True)</span></span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_gy_new, ax= ax[<span class="number">0</span>])</span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_se_new, ax= ax[<span class="number">1</span>]) </span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_pu_new, ax= ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;&lt;Figure9&gt;, 경기지역 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;&lt;Figure10&gt;, 서울지역 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">2</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;&lt;Figure11&gt;, 부산지역 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/output_25_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## top3 업종별 매출액 합계 </span></span><br><span class="line">group1_sido[<span class="string">&#x27;transacted_date&#x27;</span>] = pd.to_datetime(group1_sido[<span class="string">&#x27;transacted_date&#x27;</span>] )</span><br><span class="line"></span><br><span class="line">group1_gyr = group1_sido[group1_sido[<span class="string">&#x27;type_of_business&#x27;</span>] == <span class="string">&quot;한식 음식점업&quot;</span>]</span><br><span class="line">group1_gyr_new = group1_gyr.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_gyr_new = group1_gyr_new.reset_index()</span><br><span class="line"></span><br><span class="line">group1_ser = group1_sido[group1_sido[<span class="string">&#x27;type_of_business&#x27;</span>] == <span class="string">&quot;의복 소매업&quot;</span>]</span><br><span class="line">group1_ser_new = group1_ser.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_ser_new = group1_ser_new.reset_index()</span><br><span class="line"></span><br><span class="line">group1_pur = group1_sido[group1_sido[<span class="string">&#x27;type_of_business&#x27;</span>] == <span class="string">&quot;의약품 도매업&quot;</span>]</span><br><span class="line">group1_pur_new = group1_pur.groupby( <span class="string">&#x27;transacted_date&#x27;</span> )[<span class="string">&#x27;amount&#x27;</span>].sum()</span><br><span class="line">group1_pur_new = group1_pur_new.reset_index()</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(nrows=<span class="number">3</span>, figsize = (<span class="number">18</span>, <span class="number">12</span>))</span><br><span class="line"><span class="comment">#f,axes = plt.subplots(3,1, figsize = (18,12), sharex=True)</span></span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_gyr_new, ax= ax[<span class="number">0</span>])</span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_ser_new, ax= ax[<span class="number">1</span>]) </span><br><span class="line">sns.lineplot(y=<span class="string">&quot;amount&quot;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =group1_pur_new, ax= ax[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">&quot;&lt;Figure11&gt;, 한식 음식점업 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">&quot;&lt;Figure12&gt;, 의복 소매업 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">2</span>].set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;매출액&quot;</span>, )</span><br><span class="line">ax[<span class="number">2</span>].set_title(<span class="string">&quot;&lt;Figure13&gt;, 의약품 도매업 매출액 합계 &quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/output_26_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### top 매출업종 한식음식점업 결제금액 합계  </span></span><br><span class="line">group1_group = group1_sido.groupby([<span class="string">&#x27;type_of_business&#x27;</span>,<span class="string">&#x27;transacted_date&#x27;</span>]).sum().reset_index()</span><br><span class="line">group1_group[<span class="string">&#x27;transacted_date&#x27;</span>] = pd.to_datetime(group1_group[<span class="string">&#x27;transacted_date&#x27;</span>])</span><br><span class="line">hansik  = group1_group[ group1_group[<span class="string">&#x27;type_of_business&#x27;</span>] ==<span class="string">&quot;한식 음식점업&quot;</span>  ]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">18</span>,<span class="number">10</span>))</span><br><span class="line">ax = sns.lineplot(y=<span class="string">&#x27;amount&#x27;</span> , x=<span class="string">&quot;transacted_date&quot;</span>, data =hansik)</span><br><span class="line">ax.set( Xlabel=<span class="string">&quot;&quot;</span>, ylabel=<span class="string">&quot;결제금액&quot;</span>, )</span><br><span class="line">ax.set_title(<span class="string">&quot;&lt;Figure14&gt;, 한식음식점업 결제금액 합계&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>




<p><img src="/img/output_28_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### STL 분해 </span></span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.seasonal <span class="keyword">import</span> seasonal_decompose</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(action=<span class="string">&#x27;ignore&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 매출 1위 업종인 한식업종에 대한 STL 분해 </span></span><br><span class="line">seasonal_hansik = hansik[[<span class="string">&#x27;transacted_date&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>]].set_index(<span class="string">&#x27;transacted_date&#x27;</span>)</span><br><span class="line">ts = seasonal_hansik.amount</span><br><span class="line">result = seasonal_decompose(x= ts , model=<span class="string">&#x27;additive&#x27;</span>, freq=<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&quot;figure.figsize&quot;</span>] = (<span class="number">16</span>,<span class="number">12</span>)</span><br><span class="line">ax = result.plot()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<p><img src="/img/output_29_0.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### ARIMA 분석을 위한 ACF, PACF 그래프  </span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> statsmodels.graphics.tsaplots <span class="keyword">import</span> plot_acf, plot_pacf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 한식업종 매출에 대한 ACF, PACF 그래프 </span></span><br><span class="line">hansik_ap = hansik[[<span class="string">&#x27;transacted_date&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>]]</span><br><span class="line">hansik_ap = hansik_ap.set_index(<span class="string">&#x27;transacted_date&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plot_acf(hansik_ap)</span><br><span class="line">plot_pacf(hansik_ap)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/output_31_0.png"></p>
<p><img src="/img/output_31_1.png"></p>
<h3 id="Data-Preprocessing"><a href="#Data-Preprocessing" class="headerlink" title="Data Preprocessing"></a><strong>Data Preprocessing</strong></h3><h3 id="LGBM-Modeling"><a href="#LGBM-Modeling" class="headerlink" title="LGBM Modeling"></a><strong>LGBM Modeling</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LGBM 모델링을 위한 데이터 전처리 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 데이터를 region 과 business 열에 결측치가 유무로 두 가지의 그룹으로 구분하였다. </span></span><br><span class="line"><span class="comment"># group1(35% of all data) : region 과 business 값들에 결측치 없음 </span></span><br><span class="line"><span class="comment"># group2(65% of all data) : region 과 business 에 결측치가 존재함</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 보통의 경우에 위와 같이 결측치의 비중이 10~20%를 초과하면은 해당 칼럼들을 사용하지 않지만, </span></span><br><span class="line"><span class="comment"># 해당 데이터의 경우에, region과 business 를 제외하면은 효과적으로 데이터를 구분해줄 category 변수가 전혀 존재하지 않는다.   </span></span><br><span class="line"><span class="comment"># 따라서 tree 기반 모델링을 위해서 data 를 두 그룹으로 나누고, 한쪽 그룹에는 tree 기반 모델링을 하고, 다른 한쪽 그룹에는 </span></span><br><span class="line"><span class="comment"># non-tree 기반한 모델링을 하여서 그러한 구분이 결과값에 어떠한 영향을 끼쳤는지와 그 이유를 탐구해 볼 예정이다. </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># LGBM 모데링을 위한 group1 데이터셋 전처리</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">group1_make</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">### group1 dataset making </span></span><br><span class="line">    <span class="comment"># region과 business에서 결측치가 있는 행들을 제외 </span></span><br><span class="line">    group1 = data.dropna(subset = [<span class="string">&#x27;region&#x27;</span>, <span class="string">&#x27;type_of_business&#x27;</span>] )</span><br><span class="line">    <span class="comment"># region 에서, 시/도 추출 </span></span><br><span class="line">    sido_list = group1[<span class="string">&#x27;region&#x27;</span>].str[<span class="number">0</span>:<span class="number">2</span>]  </span><br><span class="line">    sido_list = pd.DataFrame(sido_list)</span><br><span class="line">    sido_list.columns = [<span class="string">&#x27;region_sido&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    group1_sido = pd.concat([group1, sido_list] ,axis = <span class="number">1</span> )</span><br><span class="line">    group1_sido = group1_sido.drop(<span class="string">&#x27;region&#x27;</span>,axis=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> group1_sido</span><br><span class="line"></span><br><span class="line">group1_dataset = group1_make(sales)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">group1_make_2nd</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">### group1 transform datetime &amp; groupby year and month </span></span><br><span class="line"></span><br><span class="line">    dataset = pd.DataFrame([])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        datas = data[ data[<span class="string">&#x27;store_id&#x27;</span>] == i ]</span><br><span class="line"></span><br><span class="line">        id_region_sido = datas[<span class="string">&#x27;region_sido&#x27;</span>].unique()[<span class="number">0</span>]</span><br><span class="line">        id_type_of_business = datas[<span class="string">&#x27;type_of_business&#x27;</span>].unique()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 불필요한 column 들 drop </span></span><br><span class="line">        datas = datas.drop([<span class="string">&#x27;card_id&#x27;</span>, <span class="string">&#x27;card_company&#x27;</span>, <span class="string">&#x27;transacted_time&#x27;</span>, <span class="string">&#x27;installment_term&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 날짜 데이터 datetime 변환 </span></span><br><span class="line">        datas[<span class="string">&#x27;transacted_date&#x27;</span>] = pd.to_datetime( datas[<span class="string">&#x27;transacted_date&#x27;</span>])</span><br><span class="line">        <span class="comment"># month 와 year 생성 </span></span><br><span class="line">        datas[<span class="string">&#x27;month&#x27;</span>] = datas[<span class="string">&#x27;transacted_date&#x27;</span>].dt.month</span><br><span class="line">        datas[<span class="string">&#x27;year&#x27;</span>] = datas[<span class="string">&#x27;transacted_date&#x27;</span>].dt.year </span><br><span class="line"></span><br><span class="line">        datas_grouped = datas.groupby( [<span class="string">&#x27;store_id&#x27;</span> , <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>]).sum().reset_index()</span><br><span class="line"></span><br><span class="line">        datas_grouped[<span class="string">&#x27;sido&#x27;</span>] = id_region_sido</span><br><span class="line">        datas_grouped[<span class="string">&#x27;business&#x27;</span>] = id_type_of_business</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        dataset = pd.concat( [dataset, datas_grouped], axis=<span class="number">0</span>)</span><br><span class="line">        dataset = dataset.reset_index()</span><br><span class="line">        dataset = dataset.drop([<span class="string">&#x27;index&#x27;</span>], axis=<span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line">group1 = group1_make_2nd(group1_dataset)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>Wall time: 0 ns</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_lags</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">### Feature Engineering : lag &amp; rolling mean </span></span><br><span class="line">    blank = pd.DataFrame([])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        store = data[ data.store_id == i]</span><br><span class="line">        store = store.reset_index()</span><br><span class="line">        store = store.drop([<span class="string">&#x27;index&#x27;</span>],axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># lag 1,2,3,6</span></span><br><span class="line">        lags = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>]</span><br><span class="line">        <span class="keyword">for</span> lag <span class="keyword">in</span> lags:</span><br><span class="line">            store[<span class="string">&#x27;amount_lag_&#x27;</span> + str(lag)] =store.groupby( [<span class="string">&#x27;store_id&#x27;</span>, <span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;sido&#x27;</span>,<span class="string">&#x27;business&#x27;</span>], as_index=<span class="literal">False</span> )[<span class="string">&#x27;amount&#x27;</span>].sum().shift(lag).amount</span><br><span class="line"></span><br><span class="line">        <span class="comment"># rolling mean 3,6</span></span><br><span class="line">        windows = [<span class="number">3</span>,<span class="number">6</span>]</span><br><span class="line">        <span class="keyword">for</span> window <span class="keyword">in</span> windows:</span><br><span class="line">            store[<span class="string">&#x27;rolling_mean_&#x27;</span> + str(window)] =store.amount.rolling(window=window).mean()</span><br><span class="line"></span><br><span class="line">        blank = pd.concat([blank,store], axis=<span class="number">0</span>)</span><br><span class="line">        blank = blank.reset_index()</span><br><span class="line">        blank = blank.drop( [<span class="string">&#x27;index&#x27;</span>], axis=<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> blank </span><br><span class="line">        </span><br><span class="line">group1_fin = make_lags(group1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">concat_test_set</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">### MeanEncoding &amp; Test Dataset</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Mean Encoding </span></span><br><span class="line">    <span class="comment"># 각각 지역평균 </span></span><br><span class="line">    data[<span class="string">&#x27;sido_avg&#x27;</span>] = data.groupby(<span class="string">&#x27;sido&#x27;</span>)[<span class="string">&#x27;amount&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">    <span class="comment"># 각각 업종평균 </span></span><br><span class="line">    data[<span class="string">&#x27;business_avg&#x27;</span>] = data.groupby(<span class="string">&#x27;business&#x27;</span>)[<span class="string">&#x27;amount&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">    <span class="comment"># 각각 지역 x 업종 평균 </span></span><br><span class="line">    data[<span class="string">&#x27;sido_n_business_avg&#x27;</span>] = data.groupby([<span class="string">&#x27;sido&#x27;</span>, <span class="string">&#x27;business&#x27;</span>])[<span class="string">&#x27;amount&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Test 구간인, 2019년 3월4월5일 치, 빈 데이터셋 만들기 </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()): </span><br><span class="line">        </span><br><span class="line">        X_test_blank = pd.DataFrame( [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)], columns=[<span class="string">&#x27;store_id&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>, <span class="string">&#x27;sido&#x27;</span>, <span class="string">&#x27;business&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;amount_lag_1&#x27;</span>, <span class="string">&#x27;amount_lag_2&#x27;</span>, <span class="string">&#x27;amount_lag_3&#x27;</span>, <span class="string">&#x27;amount_lag_6&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;rolling_mean_3&#x27;</span>, <span class="string">&#x27;rolling_mean_6&#x27;</span>, <span class="string">&#x27;sido_avg&#x27;</span>, <span class="string">&#x27;business_avg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sido_n_business_avg&#x27;</span>] )</span><br><span class="line">        store = data[data.store_id == i]</span><br><span class="line"></span><br><span class="line">        X_test_blank[<span class="string">&#x27;store_id&#x27;</span>] = i</span><br><span class="line">        X_test_blank[<span class="string">&#x27;sido&#x27;</span>] = store.sido.unique()[<span class="number">0</span>]</span><br><span class="line">        X_test_blank[<span class="string">&#x27;business&#x27;</span>] = store.business.unique()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        X_test_blank[<span class="string">&#x27;year&#x27;</span>] = <span class="number">2019</span></span><br><span class="line">        X_test_blank[<span class="string">&#x27;month&#x27;</span>] = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">        X_test_blank[<span class="string">&#x27;sido_avg&#x27;</span>] = store.sido_avg.unique()[<span class="number">0</span>]</span><br><span class="line">        X_test_blank[<span class="string">&#x27;business_avg&#x27;</span>] = store.business_avg.unique()[<span class="number">0</span>]</span><br><span class="line">        X_test_blank[<span class="string">&#x27;sido_n_business_avg&#x27;</span>] = store.sido_n_business_avg.unique()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        data = pd.concat( [data, X_test_blank], axis=<span class="number">0</span>)</span><br><span class="line">        new_data = data</span><br><span class="line">    <span class="keyword">return</span> new_data</span><br><span class="line"></span><br><span class="line">group1_fin_testadd = concat_test_set(group1_fin)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cos = group1_fin_testadd</span><br><span class="line">cos = cos.reset_index()</span><br><span class="line">cos = cos.drop(<span class="string">&#x27;index&#x27;</span>, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cos.columns</span><br><span class="line"><span class="comment"># [&#x27;store_id&#x27;, &#x27;year&#x27;, &#x27;month&#x27;, &#x27;amount&#x27;, &#x27;sido&#x27;, &#x27;business&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;amount_lag_1&#x27;, &#x27;amount_lag_2&#x27;, &#x27;amount_lag_3&#x27;, &#x27;amount_lag_6&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;rolling_mean_3&#x27;, &#x27;rolling_mean_6&#x27;, &#x27;sido_avg&#x27;, &#x27;business_avg&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;sido_n_business_avg&#x27;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Data Split</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test #2106   #2019년 3,4,5월</span></span><br><span class="line">cos1_test = cos[ (cos[<span class="string">&#x27;year&#x27;</span>] == <span class="number">2019</span>)  &amp;  ((cos[<span class="string">&#x27;month&#x27;</span>] == <span class="number">3</span>) | (cos[<span class="string">&#x27;month&#x27;</span>] == <span class="number">4</span>) | (cos[<span class="string">&#x27;month&#x27;</span>] == <span class="number">5</span>)) ]</span><br><span class="line"><span class="comment"># valid #1366  #2019년 1,2월 </span></span><br><span class="line">cos2_valid = cos[ (cos[<span class="string">&#x27;year&#x27;</span>] == <span class="number">2019</span>)  &amp;  ((cos[<span class="string">&#x27;month&#x27;</span>] == <span class="number">1</span>) | (cos[<span class="string">&#x27;month&#x27;</span>] == <span class="number">2</span>)) ]</span><br><span class="line"><span class="comment"># train #20356 #2016년 ~ 2018년</span></span><br><span class="line">cos3_train = cos[  (cos[<span class="string">&#x27;year&#x27;</span>] == <span class="number">2018</span>)| (cos[<span class="string">&#x27;year&#x27;</span>] == <span class="number">2017</span>)  |  (cos[<span class="string">&#x27;year&#x27;</span>] == <span class="number">2016</span>)  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Data split </span></span><br><span class="line">X_train = cos3_train.drop([<span class="string">&#x27;sido&#x27;</span>, <span class="string">&#x27;business&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">y_train = cos3_train[<span class="string">&#x27;amount&#x27;</span>]</span><br><span class="line"></span><br><span class="line">X_valid = cos2_valid.drop([<span class="string">&#x27;sido&#x27;</span>, <span class="string">&#x27;business&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">y_valid = cos2_valid[<span class="string">&#x27;amount&#x27;</span>]</span><br><span class="line"></span><br><span class="line">X_test  = cos1_test.drop([<span class="string">&#x27;sido&#x27;</span>, <span class="string">&#x27;business&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">y_test  = cos1_test[<span class="string">&#x27;amount&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Train and validate</span></span><br><span class="line">model = LGBMRegressor(</span><br><span class="line">    n_estimators=<span class="number">1000</span>,</span><br><span class="line">    learning_rate=<span class="number">0.01</span>,</span><br><span class="line">    subsample=<span class="number">0.8</span>,</span><br><span class="line">    colsample_bytree=<span class="number">0.8</span>,</span><br><span class="line">    max_depth=<span class="number">8</span>,</span><br><span class="line">    num_leaves=<span class="number">50</span>,</span><br><span class="line">    min_child_weight=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">model.fit(X_train, y_train, eval_set=[(X_train,y_train),(X_valid,y_valid)], eval_metric=<span class="string">&#x27;mae&#x27;</span>, verbose=<span class="number">20</span>, early_stopping_rounds=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">eval_preds = model.predict(X_test)</span><br><span class="line"></span><br><span class="line">X_test_result = X_test.copy()</span><br><span class="line">X_test_result[<span class="string">&#x27;pred&#x27;</span>] = eval_preds</span><br><span class="line"></span><br><span class="line"><span class="comment">### LGBM 결과치 </span></span><br><span class="line">group1_submission = X_test_result.groupby(<span class="string">&#x27;store_id&#x27;</span>)[<span class="string">&#x27;pred&#x27;</span>].sum()</span><br><span class="line">group1_submission = group1_submission.reset_index()</span><br><span class="line">group1_submission.columns = [<span class="string">&#x27;store_id&#x27;</span>,<span class="string">&#x27;amount&#x27;</span>]</span><br><span class="line">group1_submission.to_csv(<span class="string">&quot;submission_LGBM.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LGBM - Grid Search</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> r2_score, mean_squared_error, make_scorer</span><br><span class="line">RMSE = mean_squared_error(y_test, pred)**<span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.metrics</span><br><span class="line">sklearn.metrics.SCORERS.keys()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Grid Search</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line">gridParams = &#123;</span><br><span class="line">    <span class="string">&#x27;learning_rate&#x27;</span>: [<span class="number">0.01</span>,  <span class="number">0.1</span>,  <span class="number">0.2</span> ],  </span><br><span class="line">    <span class="string">&#x27;n_estimators&#x27;</span>: [<span class="number">8</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">100</span>],</span><br><span class="line">    <span class="string">&#x27;num_leaves&#x27;</span>: [<span class="number">6</span>,<span class="number">12</span>,<span class="number">32</span>] ,</span><br><span class="line">    <span class="string">&#x27;min_data_in_leaf&#x27;</span> : [<span class="number">8</span>, <span class="number">20</span>, <span class="number">36</span>],</span><br><span class="line">    <span class="string">&#x27;max_bin&#x27;</span>:[<span class="number">255</span>, <span class="number">510</span>], </span><br><span class="line">    <span class="string">&#x27;random_state&#x27;</span> : [<span class="number">500</span>],</span><br><span class="line">    <span class="string">&#x27;colsample_bytree&#x27;</span> : [<span class="number">0.64</span>, <span class="number">0.65</span>, <span class="number">0.66</span>],</span><br><span class="line">    <span class="string">&#x27;subsample&#x27;</span> : [<span class="number">0.7</span>,<span class="number">0.75</span>],</span><br><span class="line">    <span class="string">&#x27;reg_alpha&#x27;</span> : [<span class="number">1</span>,<span class="number">1.2</span>],</span><br><span class="line">    <span class="string">&#x27;reg_lambda&#x27;</span> : [<span class="number">1</span>,<span class="number">1.2</span>,<span class="number">1.4</span>],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">grid_cv = GridSearchCV(model, param_grid = gridParams, n_jobs=<span class="number">-1</span>, scoring=<span class="string">&#x27;neg_mean_absolute_error&#x27;</span>)</span><br><span class="line"></span><br><span class="line">grid_cv.fit(X_train, y_train.values.ravel())</span><br><span class="line">grid_pred = grid_cv.predict(X_test)</span><br><span class="line">grid_pred.to_csv(<span class="string">&quot;Grid_sub.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br></pre></td></tr></table></figure>




<h3 id="Modeling-MA-amp-EPMA-amp-ARIMA"><a href="#Modeling-MA-amp-EPMA-amp-ARIMA" class="headerlink" title="Modeling_MA&amp;EPMA&amp;ARIMA"></a><strong>Modeling_MA&amp;EPMA&amp;ARIMA</strong></h3><h3 id="Moving-Average"><a href="#Moving-Average" class="headerlink" title="Moving Average"></a><strong>Moving Average</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dataset_month</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment"># raw data 를 month 와 year 기준으로 resampling  </span></span><br><span class="line">    dataset =pd.DataFrame([])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        store_zero = data[data.store_id==i]</span><br><span class="line">        store_zero[<span class="string">&#x27;transacted_date&#x27;</span>] = pd.to_datetime(store_zero[<span class="string">&#x27;transacted_date&#x27;</span>])</span><br><span class="line">        pd.to_datetime(store_zero[<span class="string">&#x27;transacted_date&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        store_zero[<span class="string">&#x27;month&#x27;</span>] =store_zero[<span class="string">&#x27;transacted_date&#x27;</span>].dt.month</span><br><span class="line">        store_zero[<span class="string">&#x27;year&#x27;</span>] =store_zero[<span class="string">&#x27;transacted_date&#x27;</span>].dt.year</span><br><span class="line"></span><br><span class="line">        store_zero_1 = store_zero.drop([<span class="string">&#x27;card_id&#x27;</span>,<span class="string">&#x27;card_company&#x27;</span>,<span class="string">&#x27;transacted_date&#x27;</span>,<span class="string">&#x27;transacted_time&#x27;</span>, <span class="string">&#x27;installment_term&#x27;</span>, <span class="string">&#x27;region&#x27;</span>,<span class="string">&#x27;type_of_business&#x27;</span>],axis=<span class="number">1</span>)</span><br><span class="line">        store_zero_group = store_zero_1.groupby([<span class="string">&#x27;store_id&#x27;</span>,<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;month&#x27;</span>] ).sum().reset_index()</span><br><span class="line">        store_zero_group[<span class="string">&#x27;amount&#x27;</span>].sum() <span class="comment">#24174471</span></span><br><span class="line">        dataset= pd.concat([dataset, store_zero_group],axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line">d1 = dataset_month(sales)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MA_dataset</span>(<span class="params">data</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 이동평균(3,5) 변수 추가 </span></span><br><span class="line">    blank = pd.DataFrame([])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique() ):</span><br><span class="line">        store = data[data.store_id == i]</span><br><span class="line">        <span class="comment">#rolling mean 3,5</span></span><br><span class="line">        windows = [<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">for</span> window <span class="keyword">in</span> windows:</span><br><span class="line">            store[<span class="string">&#x27;rolling_mean_&#x27;</span> + str(window)] =store.amount.rolling(window=window).mean()</span><br><span class="line"></span><br><span class="line">        blank = pd.concat([blank,store], axis=<span class="number">0</span>)</span><br><span class="line">        blank = blank.reset_index()</span><br><span class="line">        blank = blank.drop( [<span class="string">&#x27;index&#x27;</span>], axis=<span class="number">1</span>) </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> blank.store_id.unique():</span><br><span class="line">        X_test_blank = pd.DataFrame( [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)], columns=[<span class="string">&#x27;store_id&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>,<span class="string">&#x27;rolling_mean_3&#x27;</span>,<span class="string">&#x27;rolling_mean_5&#x27;</span> ] )</span><br><span class="line">        X_test_blank.store_id = j</span><br><span class="line">        blank = pd.concat( [blank, X_test_blank], axis=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> blank</span><br><span class="line"></span><br><span class="line">new = MA_dataset(d1)</span><br></pre></td></tr></table></figure>
<pre><code>       &lt;단순이동평균&gt; </code></pre>
<p><img src="/img/MA.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MA_prediction</span>(<span class="params">data</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이동평균(3) 을 활용한 예측 모델링, 가중치값 1/3</span></span><br><span class="line">    blank = pd.DataFrame([])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        store_id = i</span><br><span class="line">        store = data[data[<span class="string">&#x27;store_id&#x27;</span>] == i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># MA Caculation </span></span><br><span class="line">        ma1 = store.rolling_mean_3[<span class="number">-4</span>:<span class="number">-3</span>].values</span><br><span class="line">        store.amount[<span class="number">-3</span>:<span class="number">-2</span>] = ma1</span><br><span class="line"></span><br><span class="line">        store.amount[<span class="number">-2</span>:<span class="number">-1</span>] = (ma1 + store.amount[<span class="number">-4</span>:<span class="number">-3</span>].values + store.amount[<span class="number">-5</span>:<span class="number">-4</span>].values )*<span class="number">1</span>/<span class="number">3</span></span><br><span class="line">        store.amount[<span class="number">-1</span>:]   = (store.amount[<span class="number">-2</span>:<span class="number">-1</span>].values + ma1 + store.amount[<span class="number">-4</span>:<span class="number">-3</span>].values )*<span class="number">1</span>/<span class="number">3</span></span><br><span class="line"></span><br><span class="line">        store_pred = store.amount[<span class="number">-3</span>:].sum()</span><br><span class="line">        dictA = &#123; <span class="string">&#x27;store_id&#x27;</span> : [store_id],  <span class="string">&#x27;amount&#x27;</span> : [store_pred] &#125;</span><br><span class="line">        df1 = pd.DataFrame( dictA )</span><br><span class="line"></span><br><span class="line">        blank = pd.concat([blank,df1],axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> blank </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MA_result_2 = MA_prediction(new)</span><br><span class="line">MA_result_2.to_csv(<span class="string">&quot;submission_MA3_1015.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>       &lt;지수이동평균&gt; </code></pre>
<p><img src="/img/EMA.png"></p>
<h3 id="Exponential-Moving-Average"><a href="#Exponential-Moving-Average" class="headerlink" title="Exponential Moving Average"></a><strong>Exponential Moving Average</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exponential_MA_prediction</span>(<span class="params">data,n</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 지수이동평균의 경우 예측모형으로 사용할 때의 가중치(w) 값은 2/(n+1)</span></span><br><span class="line">    blank = pd.DataFrame([])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        store_id = i</span><br><span class="line">        store = data[data[<span class="string">&#x27;store_id&#x27;</span>] == i]</span><br><span class="line">        store[<span class="string">&#x27;exponential_MA_5&#x27;</span>] = store.amount.ewm(span=n, adjust=<span class="literal">False</span>).mean()</span><br><span class="line">        </span><br><span class="line">        exma = store.exponential_MA_5[<span class="number">-4</span>:<span class="number">-3</span>].values</span><br><span class="line">        exma_sum = exma*<span class="number">3</span></span><br><span class="line">        </span><br><span class="line">        dictA = &#123; <span class="string">&#x27;store_id&#x27;</span> : [i], <span class="string">&#x27;amount&#x27;</span> : exma_sum &#125; </span><br><span class="line">        df1 = pd.DataFrame( dictA )</span><br><span class="line">        blank = pd.concat([blank,df1],axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> blank</span><br><span class="line"></span><br><span class="line">EX_MA_pred_5 =  Exponential_MA_prediction(new,<span class="number">5</span>)</span><br><span class="line">EX_MA_pred_3 =  Exponential_MA_prediction(new,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">EX_MA_pred_5.to_csv(<span class="string">&quot;submission_EX_MA5_1015_1.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">EX_MA_pred_3.to_csv(<span class="string">&quot;submission_EX_MA3_1015_1.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="ARIMA"><a href="#ARIMA" class="headerlink" title="ARIMA"></a><strong>ARIMA</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ARIMA Model </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 각각의 상점마다 다른 pdq 값을 적용하기 위해서, autoarima model과 유사한 알고리즘을 사용하였다. </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">p = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">d = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">q = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">pdq = list(itertools.product(p, d, q))</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> statsmodels.tsa.arima_model <span class="keyword">import</span> ARIMA</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">arima_modeling_5</span>(<span class="params">data</span>):</span></span><br><span class="line">    arima_pred_arr = np.array([])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(data.store_id.unique()):</span><br><span class="line">        data_set = data[data.store_id == i]</span><br><span class="line"></span><br><span class="line">        best_score = <span class="number">10000000000</span></span><br><span class="line">        best_param = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> pdq:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                arima_model = ARIMA(data_set.amount.values, order=param)</span><br><span class="line">                result = arima_model.fit()</span><br><span class="line">                <span class="keyword">if</span> result.aic &lt; best_score:</span><br><span class="line">                    best_score = result.aic</span><br><span class="line">                    best_param = param</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        arima_model = ARIMA(data_set.amount.values, order=best_param)</span><br><span class="line">        arima_result = arima_model.fit()</span><br><span class="line">        arima_pred = arima_result.forecast(<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        arima_pred_arr = np.concatenate((arima_pred_arr, np.array([arima_pred.sum()])))  </span><br><span class="line">    <span class="keyword">return</span> arima_pred_arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arima_result_month_all_data = arima_modeling_5(d1)</span><br><span class="line"></span><br><span class="line">arima_result_month_all_data = pd.DataFrame(arima_result_month_all_data)</span><br><span class="line">arima_result_month_all_data.to_csv(<span class="string">&quot;arima_result_submission_1015.csv&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h3><ul>
<li>최종결과<table>
<thead>
<tr>
<th>Model</th>
<th>MAE(Mean Absolute Error,<br>평균절대오차)</th>
<th>Public Board Rank</th>
</tr>
</thead>
<tbody><tr>
<td>Exponential_Moving Average(5)</td>
<td>765,887</td>
<td>9등(최종)</td>
</tr>
<tr>
<td>Exponential_Moving Average(3)</td>
<td>784,219</td>
<td>18등</td>
</tr>
<tr>
<td>Simple_Moving_Average(3)</td>
<td>810,333</td>
<td>25등</td>
</tr>
<tr>
<td>ARIMA_n_LGBM</td>
<td>1,768,874</td>
<td>93등</td>
</tr>
<tr>
<td>ARIMA</td>
<td>1,062,635</td>
<td>50등</td>
</tr>
<tr>
<td>LGBM</td>
<td>2,481,832</td>
<td>102등</td>
</tr>
</tbody></table>
</li>
</ul>
<ol>
<li>Data size</li>
</ol>
<p>해당 데이터의 경우 data size 에 관한 issue 가 있었다.<br>처음 제공된 raw data 을 탐색하였을 때, 그 사이즈가 6,556,613 rows 로 머신러닝에 활용하기에 충분한 볼륨이 있어 보였다.<br>하지만 데이터는 개별 카드의 결제 건당 매출을 기준으로 작성되었고, 대회의 최종목표는 상점별 매출을 예측하는 것이었으므로<br>resampling 과정이 불가피 하였다. card_id 는 store_id 기준으로, day 는 month 기준으로 데이터 전처리를 하였을 때,<br>6,556,613 rows 에서 60,232 rows 로 데이터의 사이즈가 약 1/100 가량 축소되었다. </p>
<ol start="2">
<li>Data variables </li>
</ol>
<p>raw data 에서 주어진 column 값들 중, store 를 구분 할 수 있는 categorical variable 은 ‘region’ 과 ‘type_of_business’<br>두 가지가 유일하였다. 하지만 그마저도 결측치의 비율이 65%에 달하여 전체 데이터셋에 일반화하여 적용하기에 무리가 있었다.<br>따라서 데이터셋을 결측치 유무에 따른 두 가지의 그룹으로 나누어서 분석을 진행하였다. </p>
<ol start="3">
<li>Modeling</li>
</ol>
<p>3.1 LGBM </p>
<p>‘region’ 과 ‘type_of_business’가 존재하는 데이터셋을 group1 로 지정하고 모델링을 진행하였다. group1 의 경우에,<br>146개의 전체 업종 중에서 매출 top10 업종이 전체 매출에서 차지하는 비중은 50% 였으며, top1 인 한식음식점업의<br>경우에 전체 매출의 16%를 차지하였다. 따라서 한식음식점 및 상위 업종의 매출 trend 및 seasonality 를 중심으로<br>모델링 하기 위하여, Feature Engineering 과정에서 이동평균과 lag 을 적극적으로 활용하여 변수에 추가하였다.<br>결과적으로 LGBM 모델링의 MAE 값은 2,481,832 로 대회 Public Board 기준으로는 102등(최하위권)을 기록하였다.<br>tree 모델을 사용하기에는 다소 부족한 데이터의 수와, categorical variable 의 부재로 인한 결과로 추측된다.  </p>
<p>3.2 Simple Moving Average, Exponential Moving Average and ARIMA </p>
<p>머신러닝을 활용한 모델링이 힘들기 때문에, 전통적인 방식의 시계열 분석 방법들을 시도해 보았다.<br>결론적으로 Exponential Moving Average(5) 에 의한 결과값이 가장 좋았다. MAE 값은 765,887 로 대회 Public Board 기준으로 9등(최상위권)<br>을 달성하였고, Simple Moving Average(3)가 25등, ARIMA가 50등의 성적을 보여주었다. </p>
<p>현재 데이터의 특성을 전적으로 보여주는 결과라고 생각을 한다. 각각의 모델은 아래와 같은 특징을 지닌다.<br>Simple Moving Average (단순이동평균) 의 경우에, 각각의 시계열에 동일한 가중치를 두고 종속변수의 평균값 및 예측값을 계산한다.<br>따라서 계절성이 적고 추세성이 강한 데이터를 잘 예측할 확률이 높다. </p>
<p>Exponential MA (지수이동평균) 의 경우에는 예측시점에 가까운 데이터일수록 가중치를 강하게 가져가고, 예측시점에서 먼 데이터일수록<br>가중치를 낮게 준다. 따라서 단순이동평균에 비해서 최근의 데이터 변화에 민감한 예측을 하게 된다. </p>
<p>ARIMA 모델의 경우에는 예측값들이 가지는 관계성에 비중을 두는 모델이다. 따라서 패턴성이 강하고 시계열이 길게 주어질 수록<br>예측력이 높아지는 경향이 있다. </p>
<p>앞서 group1 에 관한 분석과 같이, 한식음식점업이 업종이 드러나지 않은 데이터 전체에서 차지하는 비중이 매우 크다고 가정할 때<br>한식음식점업이 가지는 데이터의 패턴은 데이터 전체에 영향을 끼칠 확률이 높다. 따라서 계절성과 추세성이 약한 요식업의 특성상,<br>Exponential MA (지수이동평균) 모델이 현 데이터를 가장 잘 예측한 것이 아닐까 추론해 보았다. </p>
<p><img src="/img/result_dacon.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-10-10T09:05:12.000Z" title="2020-10-10T09:05:12.000Z">2020-10-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-10-19T06:22:02.339Z" title="2020-10-19T06:22:02.339Z">2020-10-19</time></span><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a><span> / </span><a class="link-muted" href="/categories/Python/Cos-Pro-1%EA%B8%89/">Cos Pro 1급</a></span><span class="level-item">5 minutes read (About 716 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/10/10/1%EA%B8%89-1%EC%B0%A8-10%EB%B2%88/">Cos Pro Python 1급 1차 10번 문제풀이</a></h1><div class="content"><blockquote>
<p>Contents of table:</p>
<ul>
<li><a href="#--------"><strong>문제내용</strong></a></li>
<li><a href="#--------"><strong>정답코드</strong></a></li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>Topic: 주식으로 최대 수익을 내세요 </p>
<p>Review:<br>Solution 함수를 역으로 훑어오면은, price=3 일때, mn 값이 1여야 하므로, 해당 아이디어를 가지고 수식을 훑으면<br>수익률을 return 하는 부분인, mn - price가 아닌, price-mn 이 되어야 함을 알 수 있다. </p>
</blockquote>
<hr>
<h3 id="정답코드"><a href="#정답코드" class="headerlink" title="정답코드"></a><strong>정답코드</strong></h3><hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solution</span>(<span class="params">prices</span>):</span></span><br><span class="line">    inf = <span class="number">1000000001</span>;</span><br><span class="line">    mn = inf</span><br><span class="line">    ans = -inf</span><br><span class="line">    <span class="keyword">for</span> price <span class="keyword">in</span> prices: <span class="comment">#price 1 , price2, mn = 1 , price3, mn = 1 </span></span><br><span class="line">        <span class="keyword">if</span> mn != inf:    <span class="comment">#mn =1001 , inf = 1001 // mn =1, inf = 1001 // mn=1, inf =1001    </span></span><br><span class="line">            ans = max(ans, price - mn) <span class="comment"># 문제 코드에서는 mn - price 로 되어있다. ans = max( -1001, 2-1)= 1 // ans = max(1, 3 - 1) = 2  </span></span><br><span class="line">        mn = min(mn, price) <span class="comment">#price 1, mn = 1 </span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="문제내용"><a href="#문제내용" class="headerlink" title="문제내용"></a><strong>문제내용</strong></h3><h3 id="문제10"><a href="#문제10" class="headerlink" title="문제10"></a><strong>문제10</strong></h3><p>지난 연속된 n일 동안의 주식 가격이 순서대로 들어있는 리스트가 있습니다. 이때, 다음 규칙에 따라 주식을 사고 팔았을 때의 최대 수익을 구하려 합니다.</p>
<ul>
<li>n일 동안 주식을 단 한 번 살 수 있습니다.</li>
<li>n일 동안 주식을 단 한 번 팔 수 있습니다.</li>
<li>주식을 산 날에 바로 팔 수는 없으며, 최소 하루가 지나야 팔 수 있습니다.</li>
<li>적어도 한 번은 주식을 사야하며, 한 번은 팔아야 합니다.</li>
</ul>
<p>주식을 팔 때는 반드시 이전에 주식을 샀어야 하며, 최대 수익은 양수가 아닐 수도 있습니다.</p>
<p>연속된 n 일 동안의 주식 가격이 순서대로 들어있는 리스트 prices가 매개변수로 주어질 때, 주식을 규칙에 맞게 한 번만 사고팔았을 때 얻을 수 있는 최대 수익을 return 하도록 solution 함수를 작성했습니다. 그러나, 코드 일부분이 잘못되어있기 때문에, 코드가 올바르게 동작하지 않습니다. 주어진 코드에서 _<strong>한 줄</strong>_만 변경해서 모든 입력에 대해 올바르게 동작하도록 수정해주세요.</p>
<hr>
<h3 id="매개변수-설명"><a href="#매개변수-설명" class="headerlink" title="매개변수 설명"></a><strong>매개변수 설명</strong></h3><p>연속된 n 일 동안의 주식 가격이 순서대로 들어있는 리스트 prices가 solution 함수의 매개변수로 주어집니다.</p>
<ul>
<li>prices의 길이는 2 이상 1,000,000 이하입니다.</li>
<li>prices의 각 원소는 1 이상 1,000 이하의 자연수입니다.</li>
</ul>
<hr>
<p>#####return 값 설명<br>주식을 규칙에 맞게 한 번만 사고팔았을 때 얻을 수 있는 최대 수익을 return 해주세요.</p>
<hr>
<h3 id="예시"><a href="#예시" class="headerlink" title="예시"></a><strong>예시</strong></h3><table>
<thead>
<tr>
<th>prices</th>
<th>return</th>
</tr>
</thead>
<tbody><tr>
<td>[1,2,3]</td>
<td>2</td>
</tr>
<tr>
<td>[3,1]</td>
<td>-2</td>
</tr>
</tbody></table>
<h3 id="예시-설명"><a href="#예시-설명" class="headerlink" title="예시 설명"></a><strong>예시 설명</strong></h3><p>예시 #1<br>연속된 3일의 주가가 차례로 [1, 2, 3] 이며, 첫째 날에 주식을 사서 셋째 날에 팔면 수익은 2이고, 이때가 최대입니다.</p>
<p>예시 #2<br>문제에서 설명한 것처럼 무조건 한 번은 매수하고, 한 번은 매도해야 합니다. 첫째 날에 매수하여 둘째 날에 매도하는 방법밖에 없기 때문에 수익은 -2, 즉 2만큼 손실을 보게 됩니다.</p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/6/">6</a></li></ul></nav></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Eric"></figure><p class="title is-size-4 is-block line-height-inherit">Eric</p><p class="is-size-6 is-block">Developer blog</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seonyudo</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tag</p><a href="/tags"><p class="title">1</p></a></div></div></nav><div class="level"><a class="level-item button has-background-warning" href="/" target="_blank" rel="noopener">Have a nice day</a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Kaggle/"><span class="level-start"><span class="level-item">Kaggle</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Projects/Time-Series/"><span class="level-start"><span class="level-item">Time Series</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Python/Cos-Pro-1%EA%B8%89/"><span class="level-start"><span class="level-item">Cos Pro 1급</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-10-20T04:05:12.000Z">2020-10-20</time></p><p class="title is-6"><a class="link-muted" href="/2020/10/20/Project_Card_Sales_1019_1/">Project_DACON_상점 신용카드 매출 예측 경진대회</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Projects/">Projects</a> / <a class="link-muted" href="/categories/Projects/Time-Series/">Time Series</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-10-10T09:05:12.000Z">2020-10-10</time></p><p class="title is-6"><a class="link-muted" href="/2020/10/10/1%EA%B8%89-1%EC%B0%A8-10%EB%B2%88/">Cos Pro Python 1급 1차 10번 문제풀이</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Python/">Python</a> / <a class="link-muted" href="/categories/Python/Cos-Pro-1%EA%B8%89/">Cos Pro 1급</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-27T10:05:12.000Z">2020-09-27</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/27/1%EA%B8%89-2%EC%B0%A8-01%EB%B2%88/">Cos Pro Python 1급 2차 01번 문제풀이</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Python/">Python</a> / <a class="link-muted" href="/categories/Python/Cos-Pro-1%EA%B8%89/">Cos Pro 1급</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-27T04:05:12.000Z">2020-09-27</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/27/1%EA%B8%89-1%EC%B0%A8-09%EB%B2%88/">Cos Pro Python 1급 1차 09번 문제풀이</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Python/">Python</a> / <a class="link-muted" href="/categories/Python/Cos-Pro-1%EA%B8%89/">Cos Pro 1급</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-09-21T22:05:12.000Z">2020-09-22</time></p><p class="title is-6"><a class="link-muted" href="/2020/09/22/project_kaggle_m5_0922/">Kaggle M5 Competition Part 1 -EDA</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Kaggle/">Kaggle</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">12</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="" height="28"></a><p class="size-small"><span>&copy; 2020 Eric Park</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><!--!--></body></html>